自定义注解校验幂等性
1.自定义一个注解标志性的概念
2.使用拦截器拦截请求，可以处理权限问题


<font color='red'>校验接口幂等性：</font>

1.先在redis中创建一个token（这个token只能在接口中使用一次） 
2.调用接口时，token作为参数放在请求头中
3.一个token只能调用一次接口，调用完接口后删除redis中的token
4.再次调用该接口，token不存在报错

[幂等参考文章](https://www.cnblogs.com/javalyy/p/8882144.html)

<font color='red'>幂等性解释：</font>

幂等性：就是用户对于同一操作发起的一次请求或者多次请求的结果是一致的，不会因为多次点击而产生了副作用

<font color='red'>举个最简单的例子：</font>那就是支付，用户购买商品后支付，支付扣款成功，但是返回结果的时候网络异常，此时钱已经扣了，用户再次点击按钮，此时会进行第二次扣款，返回结果成功，用户查询余额发现多扣钱了，流水记录也变成了两条。在以前的单应用系统中，我们只需要把数据操作放入事务中即可，发生错误立即回滚，但是再响应客户端的时候也有可能出现网络中断或者异常等等。（数据库事务，操作的时候成功了，但是响应客户端的时候出现错误网络中断或把服务停止，事务也不会回滚，会操作成功）


<font color='red'>接口幂等：</font>

增删改查操作，查询和删除本身都是幂等的；

用户多次点击按钮调用接口时：修改在大多数场景下结果是一样的，增加在重复提交的场景下会出现重复数据；<font color='red'>幂等是指多次重复点击按扭调用接口，修改和增加的结果是一样的;</font>

<font color='red'>方法一：</font>单次支付请求，也就是直接支付了，不需要额外的数据库操作了，这个时候发起异步请求创建一个唯一的ticketId，就是门票，这张门票只能使用一次就作废，具体步骤如下：

1、异步请求获取门票

2、调用支付，传入门票

3、根据门票ID查询此次操作是否存在，如果存在则表示该操作已经执行过，直接返回结果；如果不存在，支付扣款，保存结果

4、返回结果到客户端

如果步骤4通信失败，用户再次发起请求，那么最终结果还是一样的.


---


<font color='red'>方法二：分布式环境下各个服务相互调用</font>

商城下单-> 调用支付服务扣款->调用订单服务更新订单状态->再保存流水

1、查询订单支付状态

2、如果已经支付直接返回结果

3、如果未支付，则支付扣款并且保存流水

4、返回支付结果

如果步骤4通信失败，用户可以再次发起请求，最终结果还是一样的









